language : cpp
compiler: gcc
os: linux
dist: xenial

install:
    - sudo echo "deb http://de.archive.ubuntu.com/ubuntu/ eoan main restricted" >> /etc/apt/sources.list
    - sudo echo "deb http://de.archive.ubuntu.com/ubuntu/ eoan universe" >> /etc/apt/sources.list
    - sudo apt-get -qq update
    - sudo apt-get -qq install qt5-default libswiften-dev qtdeclarative5-dev

    - sudo apt-get install systemd # new version nedded by ejabberd
    - sudo apt-get install ejabberd
    - sudo ejabberdctl register user1 localhost user1
    - sudo ejabberdctl register user2 localhost user2

before_script:
    - "export DISPLAY=:99.0"
    - "sh -e /etc/init.d/xvfb start"
    - sleep 3

script:
    # standard x86 build
    - mkdir -p build/x86
    - cd build/x86
    - qmake ../.. DEFINES+=TRAVIS
    - make
    - cd ..

    # build for testing
    - mkdir test
    - cd test
    - qmake ../.. DEFINES+=TRAVIS DEFINES+=dbus
    - make

    # run the test clients
    - ./harbour-shmoose lhs &
    - ./harbour-shmoose rhs &
    - cd ../..

    # build the test
    -  cd test/integration_test/ClientCommunicationTest/
    - mkdir build
    - cd build
    - qmake ..
    - make
    - ./ClientCommunicationTest
    - cd ../../..


