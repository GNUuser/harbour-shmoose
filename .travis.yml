language : cpp
compiler: gcc
os: linux
dist: xenial

install:
    - sudo echo "deb http://de.archive.ubuntu.com/ubuntu/ eoan main restricted" >> /etc/apt/sources.list
    - sudo echo "deb http://de.archive.ubuntu.com/ubuntu/ eoan universe" >> /etc/apt/sources.list
    - sudo apt-get -qq update
    - sudo apt-get -qq install qt5-default libqt5sql5-sqlite libswiften-dev qtdeclarative5-dev qml-module-qtquick2 qml-module-qtquick-controls lcov

    - sudo apt-get install systemd # new version nedded by ejabberd
    - sudo apt-get install xvfb ejabberd
    - sudo ejabberdctl register user1 localhost user1
    - sudo ejabberdctl register user2 localhost user2

    - sudo sed -e s/'## "\/upload": mod_http_upload'/'"\/upload": mod_http_upload'/ -i /etc/ejabberd/ejabberd.yml
    - sudo sed -e s/'## mod_http_upload:'/'mod_http_upload:'/ -i /etc/ejabberd/ejabberd.yml
    - sudo sed -e s/'##   put_url:'/'   put_url:'/ -i /etc/ejabberd/ejabberd.yml
    - sudo systemctl restart ejabberd

script:
    # standard x86 build
    - mkdir -p buildx86
    - cd buildx86
    - qmake .. DEFINES+=TRAVIS
    - make
    - cd ..

    # testing. build and run
    - ./scripts/travis/testing.sh

